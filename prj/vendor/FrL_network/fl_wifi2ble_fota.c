/**************************************************************************
 *    (C)2025 Freelux
 *
 *File 				: fl_wifi2ble_fota.c
 *Created on		: Oct 13, 2025
 *Author			: Freelux RnD Team
 *Description		:
 *License: Revised BSD License, see LICENSE.TXT file include in the project
 **************************************************************************/



/******************************************************************************/
/******************************************************************************/
/***                                Global Parameters                        **/
/******************************************************************************/
/******************************************************************************/
#include "tl_common.h"
#ifdef MASTER_CORE
/******************************************************************************/
/******************************************************************************/
/***                           Private definitions                           **/
/******************************************************************************/
/******************************************************************************/
#define FW_DATA_SIZE 		32
fl_pack_t g_fw_array[FW_DATA_SIZE];
fl_data_container_t G_FW_CONTAINER = { .data = g_fw_array, .head_index = 0, .tail_index = 0, .mask = FW_DATA_SIZE - 1, .count = 0 };

/******************************************************************************/
/******************************************************************************/
/***                       Functions declare                   		         **/
/******************************************************************************/
/******************************************************************************/
u8 fl_wifi2ble_fota_push(u8 *_fw, u8 _len) {
	fl_pack_t fw_pack;
	fw_pack.length = _len;
	memset(fw_pack.data_arr,0,sizeof(fw_pack.data_arr));
	memcpy(fw_pack.data_arr,_fw,_len);
	if (FL_QUEUE_ADD(&G_FW_CONTAINER,&fw_pack) < 0) {
		ERR(INF_FILE,"Err FULL <QUEUE ADD FW FOTA>!!\r\n");
		return -1;
	} else {
//		P_PRINTFHEX_A(INF_FILE,fw_pack.data_arr,fw_pack.length,"%s(%d):","FW[%d]",fw_pack.data_arr[0]);
		return G_FW_CONTAINER.tail_index;
	}
	return -1;
}


/******************************************************************************/
/******************************************************************************/
/***                            Functions callback                           **/
/******************************************************************************/
/******************************************************************************/



/******************************************************************************/
/******************************************************************************/
/***                      Processing functions 					             **/
/******************************************************************************/
/******************************************************************************/
void fl_wifi2ble_fota_init(void){
	LOG_P(INF_FILE,"FOTA Initilization!!!\r\n");
}

void fl_wifi2ble_fota_run(void) {
	fl_pack_t fw_in_queue;
	if (FL_QUEUE_GET(&G_FW_CONTAINER,&fw_in_queue)) {
		u16 ordinal = MAKE_U16(fw_in_queue.data_arr[1],fw_in_queue.data_arr[0]);
		P_PRINTFHEX_A(INF_FILE,fw_in_queue.data_arr+2,fw_in_queue.length -2,"FW[%d]",ordinal);
	}
}
#endif
