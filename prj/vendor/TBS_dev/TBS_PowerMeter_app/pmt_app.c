/**************************************************************************
 *    (C)2025 Freelux
 *
 *File 				: pmt_app.c
 *Created on		: Jan 24, 2026
 *Author			: Freelux RnD Team
 *Description		:
 *License: Revised BSD License, see LICENSE.TXT file include in the project
 **************************************************************************/
#include "tl_common.h"
#ifdef POWER_METER_DEVICE
#include "vendor/FrL_network/fl_nwk_handler.h"
/******************************************************************************/
/******************************************************************************/
/***                                Global Parameters                        **/
/******************************************************************************/
/******************************************************************************/

/******************************************************************************/
/******************************************************************************/
/***                           Private definitions                           **/
/******************************************************************************/
/******************************************************************************/

static void pmt_calip(void *_arg, u8 _size) {
    double *args = (double *)_arg;  //
    LOGA(USER,"Calip cmd(%d): %.2lf,%.2lf,%.2lf,%.2lf,%.2lf\r\n",_size,
         (_size > 0 ? args[0] : 0.0),
         (_size > 1 ? args[1] : 0.0),
         (_size > 2 ? args[2] : 0.0),
         (_size > 3 ? args[3] : 0.0),
         (_size > 4 ? args[4] : 0.0));
}
/******************************************************************************/
/******************************************************************************/
/***                       Functions declare                   		         **/
/******************************************************************************/
/******************************************************************************/

void pmt_init(void){

}

/******************************************************************************/
/******************************************************************************/
/***                            Functions callback                           **/
/******************************************************************************/
/******************************************************************************/

typedef struct{
	char* cmd_name;
	void (*ExcFunc)(void*,u8);
}pmt_cmd_t;

pmt_cmd_t PMT_CMD[] = {{"calip",pmt_calip}};

void pmt_serial_proc(u8* _cmd,u8 _len){
	char cmd[10];
	double para[5];
//	u8 arg[200];
//	memset(arg,0,SIZEU8(arg));
	int rslt = sscanf((char*) _cmd,"%s %lf %lf %lf %lf %lf",cmd,&para[0],&para[1],&para[2],&para[3],&para[4]);
	if (rslt >= 1) {
		for (u8 var = 0; var < sizeof(PMT_CMD)/sizeof(PMT_CMD[0]); ++var) {
			if(-1 != plog_IndexOf((u8*)cmd,(u8*)PMT_CMD[var].cmd_name,strlen(PMT_CMD[var].cmd_name),strlen(cmd))){
				PMT_CMD[var].ExcFunc((void*)para,rslt-1);
			}
		}
	}
}

/******************************************************************************/
/******************************************************************************/
/***                      Processing functions 					             **/
/******************************************************************************/
/******************************************************************************/


#endif //POWER_METER_DEVICE
